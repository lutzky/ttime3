(()=>{"use strict";var e={508:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(...t){if(0===t.length)return[[]];const r=e(...t.slice(1));return t[0].map((e=>r.map((t=>[e].concat(t))))).reduce(((e,t)=>e.concat(t)))}},903:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getCatalogs=t.catalogNameFromUrl=t.parse=t.parseCheeseForkTestDate=void 0;const r=/([0-9]{1,2})\.([0-9]{1,2})\.([0-9]{4})/;function n(e){if(!e)return null;const t=r.exec(e);if(null==t)return console.warn("Failed to match date regex with: ",e),null;const n=Number(t[3]),s=Number(t[2]),o=Number(t[1]);return new Date(n,s-1,o)}function s(e){const t=e.substr(e.lastIndexOf("_")+1,6),r=Number(t.slice(0,4)),n=Number(t.slice(4));let s;return s=1===n?`${r}/${String(r+1).slice(2)}`:`${r+1}`,`${{1:"Winter",2:"Spring",3:"Summer"}[n]} ${s} (CheeseFork)`}t.parseCheeseForkTestDate=n,t.parse=function(e){const t="var courses_from_rishum = ",r={academicPoints:"נקודות",building:"בניין",courseId:"מספר מקצוע",courseName:"שם מקצוע",day:"יום",dayLetters:"אבגדהוש",faculty:"פקולטה",group:"קבוצה",hour:"שעה",lecturer_tutor:"מרצה/מתרגל",moed_a:"מועד א",moed_b:"מועד ב",notes:"הערות",num:"מס.",room:"חדר",sport:"ספורט",thoseInCharge:"אחראים",type:"סוג"},s=new Map([["הרצאה","lecture"],["תרגול","tutorial"]]),o=new Map;if(!e.startsWith(t))throw new Error("Not valid cheesefork jsData - lacks expected prefix");return JSON.parse(e.substring(t.length)).forEach((e=>{const t=e.general[r.faculty];o.has(t)||o.set(t,{courses:[],name:t,semester:"cheesefork-unknown-semester"});const a=o.get(t),u={academicPoints:Number(e.general[r.academicPoints]),faculty:a,groups:[],id:Number(e.general[r.courseId]),lecturerInCharge:e.general[r.thoseInCharge],name:e.general[r.courseName],notes:e.general[r.notes],testDates:[e.general[r.moed_a],e.general[r.moed_b]].map(n).filter((e=>null!=e))},i=new Map,c=new Map;e.schedule.forEach((e=>{const n=e[r.group],o=e[r.num];if(i.has(o)||i.set(o,n),i.get(o)!==n)return;if(!c.has(o)){let n="",a="";t===r.sport?(n="sport",a=e[r.type]):n=s.get(e[r.type])||e[r.type],c.set(o,{course:u,description:a,events:[],id:o,teachers:[],type:n})}const a=c.get(o),l=e[r.hour].split(" - ").map((e=>{const t=e.split(":");let r=60*Number(t[0]);return t.length>1&&(r+=10*Number(t[1])),r})),d={day:r.dayLetters.indexOf(e[r.day]),endMinute:l[1],group:a,location:e[r.building]+" "+e[r.room],startMinute:l[0]};{const t=e[r.lecturer_tutor];t&&!a.teachers.includes(t)&&a.teachers.push(t)}a.events.push(d)})),c.forEach(((e,t)=>{u.groups.push(e)})),a.courses.push(u)})),Array.from(o.values())},t.catalogNameFromUrl=s,t.getCatalogs=function(e){return new Promise(((t,r)=>{const n=new XMLHttpRequest;n.open("GET","https://api.github.com/repos/michael-maltsev/cheese-fork/contents/courses?ref=gh-pages",!0),e&&(console.info("Using API token"),n.setRequestHeader("Authorization","Basic "+btoa("lutzky:"+e))),n.onload=()=>{if(200===n.status){if(e)for(const e of["X-RateLimit-Limit","X-RateLimit-Remaining"])console.info(`${e}: ${n.getResponseHeader(e)}`);try{const e=JSON.parse(n.responseText).map((e=>e.download_url)).filter((e=>e.endsWith(".min.js"))).map((e=>[s(e),e])).sort(((e,t)=>e[1]<t[1]?-1:1));t(e)}catch(e){r(e)}}else r(Error(`HTTP ${n.status}: ${n.statusText}`))},n.onerror=()=>{r(Error("Network Error"))},n.send()}))}},200:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.groupsByType=t.fixRawCatalog=t.loadCatalog=t.eventsCollide=t.sortEvents=t.FilterSettings=t.Schedule=t.AcademicEvent=t.Course=t.Group=t.Faculty=void 0;const n=r(903);function s(e){e.sort(((e,t)=>e.day!==t.day?e.day-t.day:e.startMinute-t.startMinute))}function o(e){return e instanceof Date?e:new Date(e.year,e.month-1,e.day)}function a(e){e.forEach((e=>{e.courses.forEach((t=>{t.faculty=e,t.testDates&&(t.testDates=t.testDates.map(o)),t.groups&&t.groups.forEach((e=>{e.course=t,e.events&&e.events.forEach((t=>{t.group=e}))}))}))}))}t.Faculty=class{},t.Group=class{},t.Course=class{},t.AcademicEvent=class{},t.Schedule=class{},t.FilterSettings=class{},t.sortEvents=s,t.eventsCollide=function(e){const t=e.slice();s(t);for(let e=0;e<t.length-1;e++)if(t[e].day===t[e+1].day&&t[e+1].startMinute<t[e].endMinute)return!0;return!1},t.loadCatalog=function(e){return new Promise(((t,r)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.onload=()=>{if(200===s.status){let o=null;try{if("["===s.responseText[0])o=JSON.parse(s.responseText);else{o=n.parse(s.responseText);for(const t of o)t.semester=n.catalogNameFromUrl(e)}a(o),t(o)}catch(e){r(e)}}else r(Error(s.statusText))},s.onerror=()=>{r(Error("Network Error"))},s.send()}))},t.fixRawCatalog=a,t.groupsByType=function(e){const t=new Map;return e.groups?(e.groups.forEach((e=>{t.has(e.type)||t.set(e.type,[]),t.get(e.type).push(e)})),Array.from(t.values())):[]}},512:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ScheduleRating=void 0;const n=r(200);function s(e){return e.location?e.location.split(" ")[0]:e.location}function o(e){const t=e.slice();let r=0;(0,n.sortEvents)(t);for(let e=0;e<t.length-1;e++)if(t[e].day===t[e+1].day&&t[e+1].startMinute===t[e].endMinute){const n=s(t[e]),o=s(t[e+1]);n&&o&&n!==o&&r++}return r}function a(e){const t=[!1,!1,!1,!1,!1];return e.forEach((e=>{t[e.day]=!0})),t.filter((e=>!1===e)).length}t.ScheduleRating=class{},t.default=function(e){return{earliestStart:Math.min(...e.map((e=>e.startMinute/60))),freeDays:a(e),latestFinish:Math.max(...e.map((e=>e.endMinute/60))),numRuns:o(e)}}},399:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generateSchedules=t.setDebug=void 0;let n=!1;t.setDebug=function(e){e&&console.info("Called scheduler.setDebug with",e),n=e};const s=r(200),o=r(508),a=r(512);function u(e){return!(0,s.eventsCollide)(e.events)}function i(e,t,r){const s=e.filter(t);return n&&console.info(`Filter ${r} removed ${e.length-s.length} schedules`),s}function c(e){return{events:e.reduce(((e,t)=>e.concat(t.events)),[]),rating:null}}t.generateSchedules=function(e,t){n&&console.time("generateSchedules");const r=Array.from(e).map((e=>function(e,t){return null==e.groups?(console.warn("Scheduling with groupless course",e),e):(e.groups=e.groups.filter((r=>!t.forbiddenGroups.includes(`${e.id}.${r.id}`))),e)}(e,t))).map(s.groupsByType).reduce(((e,t)=>e.concat(t)),[]);let l=(0,o.default)(...r).map(c);return t.noCollisions&&(l=i(l,u,"noCollisions")),n&&console.info(`${l.length} total schedules`),function(e){for(const t of e)t.rating=(0,a.default)(t.events)}(l),l=function(e,t){let r=e.slice();return t.noCollisions&&(r=i(r,u,"noCollisions")),r=function(e,t){return Object.keys(t.ratingMin).forEach((r=>{null==t.ratingMin[r]&&null==t.ratingMax[r]||(e=i(e,(e=>!(null!=t.ratingMin[r]&&e.rating[r]<t.ratingMin[r]||null!=t.ratingMax[r]&&e.rating[r]>t.ratingMax[r])),`Rating '${r}'`))})),e}(r,t),r}(l,t),n&&console.timeEnd("generateSchedules"),l}}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(()=>{const e=self,t=r(399);e.onmessage=r=>{if(void 0===r.data.debug)try{const n=(0,t.generateSchedules)(r.data.courses,r.data.filterSettings);e.postMessage(n)}catch(t){console.error("Caught exception in worker:",t),e.postMessage(null)}else(0,t.setDebug)(r.data.debug)}})()})();